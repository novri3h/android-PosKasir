var matched,browser;jQuery.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},matched=jQuery.uaMatch(navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),jQuery.browser=browser,function(a){var b=(a.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},a.fn.extend({caret:function(a,b){if(0!=this.length){if("number"==typeof a)return b="number"==typeof b?b:a,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(a,b);else if(this.createTextRange){var c=this.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()}});if(this[0].setSelectionRange)a=this[0].selectionStart,b=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var c=document.selection.createRange();a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length}return{begin:a,end:b}}},unmask:function(){return this.trigger("unmask")},mask:function(d,e){if(!d&&this.length>0){var f=a(this[0]);return f.data(a.mask.dataName)()}e=a.extend({placeholder:"_",completed:null},e);var g=a.mask.definitions,h=[],i=d.length,j=null,k=d.length;return a.each(d.split(""),function(a,b){"?"==b?(k--,i=a):g[b]?(h.push(new RegExp(g[b])),null==j&&(j=h.length-1)):h.push(null)}),this.trigger("unmask").each(function(){function f(a){for(;++a<=k&&!h[a];);return a}function l(a){for(;--a>=0&&!h[a];);return a}function m(a,b){if(!(0>a)){for(var c=a,d=f(b);k>c;c++)if(h[c]){if(!(k>d&&h[c].test(u[d])))break;u[c]=u[d],u[d]=e.placeholder,d=f(d)}r(),t.caret(Math.max(j,a))}}function n(a){for(var b=a,c=e.placeholder;k>b;b++)if(h[b]){var d=f(b),g=u[b];if(u[b]=c,!(k>d&&h[d].test(g)))break;c=g}}function o(a){var b=a.which;if(8==b||46==b||c&&127==b){var d=t.caret(),e=d.begin,g=d.end;return g-e==0&&(e=46!=b?l(e):g=f(e-1),g=46==b?f(g):g),q(e,g),m(e,g-1),!1}return 27==b?(t.val(v),t.caret(0,s()),!1):void 0}function p(a){var b=a.which,c=t.caret();if(a.ctrlKey||a.altKey||a.metaKey||32>b)return!0;if(b){c.end-c.begin!=0&&(q(c.begin,c.end),m(c.begin,c.end-1));var d=f(c.begin-1);if(k>d){var g=String.fromCharCode(b);if(h[d].test(g)){n(d),u[d]=g,r();var i=f(d);t.caret(i),e.completed&&i>=k&&e.completed.call(t)}}return!1}}function q(a,b){for(var c=a;b>c&&k>c;c++)h[c]&&(u[c]=e.placeholder)}function r(){return t.val(u.join("")).val()}function s(a){for(var b=t.val(),c=-1,d=0,f=0;k>d;d++)if(h[d]){for(u[d]=e.placeholder;f++<b.length;){var g=b.charAt(f-1);if(h[d].test(g)){u[d]=g,c=d;break}}if(f>b.length)break}else u[d]==b.charAt(f)&&d!=i&&(f++,c=d);return!a&&i>c+1?(t.val(""),q(0,k)):(a||c+1>=i)&&(r(),a||t.val(t.val().substring(0,c+1))),i?d:j}var t=a(this),u=a.map(d.split(""),function(a,b){return"?"!=a?g[a]?e.placeholder:a:void 0}),v=t.val();t.data(a.mask.dataName,function(){return a.map(u,function(a,b){return h[b]&&a!=e.placeholder?a:null}).join("")}),t.attr("readonly")||t.one("unmask",function(){t.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){v=t.val();var b=s();r();var c=function(){b==d.length?t.caret(0,b):t.caret(b)};(a.browser.msie?c:function(){setTimeout(c,0)})()}).bind("blur.mask",function(){s(),t.val()!=v&&t.change()}).bind("keydown.mask",o).bind("keypress.mask",p).bind(b,function(){setTimeout(function(){t.caret(s(!0))},0)}),s()})}})}(jQuery);