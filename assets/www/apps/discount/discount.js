!function(){"use strict";function a(a,b,c,d){function e(){return Math.floor((new Date).getTime()/1e3)}function f(a){a=a||"";var b=_.random(100,999);b+="";var c=e();c="M"+c;var d=c.slice(-5),f=_.uniqueId(a);return f+b+d}function g(a){var b=".",c=",",d="";a+="",a=a.replace(new RegExp(",","g"),"");for(var e=a.split(b),f=e[0].split("").reverse(),g=Array(),h=0;h<f.length;h++)g[g.length]=h%3===2&&h<f.length-1?c+f[h]:f[h];var i=g.reverse().join("");return a.indexOf(b)>=0&&parseInt(e[1])&&(i+=b+e[1]),d=i}function h(a){var b="0";a+="",a=a.replace(new RegExp(" ","g"),"");var c=a.split(".");if(c.length>1){var d=c[0].replace(new RegExp(",","g"),""),e=c[1].replace(new RegExp(",","g"),"");b=parseInt(e)?d+"."+e:d}else b=a.replace(new RegExp(",","g"),"");return b.length<1&&(b="0"),b}function i(){C.categoryLoading=!0,$.ajax({context:b,type:"POST",url:A+"category_list/",dataType:"json",data:{last_count:C.categorys.length},success:function(a){C.categoryLoading=!1,a.categorys&&a.categorys.forEach(function(a){if(C.categorys.length){var b=_.findIndex(C.categorys,function(b){return b.category_uxid==a.category_uxid});-1===b?C.categorys.push(a):C.categorys[b]=a}else C.categorys.push(a)}),C.$apply()},complete:function(){C.categoryLoading=!1,C.$apply()},error:function(){C.categoryLoading=!1,C.$apply()}})}function j(a){angular.forEach(C.categorys,function(a){a.selected=!1}),C.category=a,C.category.selected=!0,C.productSearch="",C.categoryNameSelected=a.category_name}function k(){C.productSearch="",""==C.categoryNameSelected?l():C.categoryNameSelected=""}function l(){C.productEmpty=!1,(void 0!==C.categoryNameSelected||null!==C.categoryNameSelected)&&(C.categoryNameSelected.length?C.productSearch.length?(C.products=[],q()):(C.products=[],o()):C.productSearch.length?(C.products=[],p(),angular.forEach(C.categorys,function(a){a.selected=!1})):(C.products=[],n(),angular.forEach(C.categorys,function(a){a.selected=!1})))}function m(){C.productEmpty=!1,(void 0!==C.categoryNameSelected||null!==C.categoryNameSelected)&&(C.categoryNameSelected.length?C.productSearch.length?q():o():C.productSearch.length?(p(),angular.forEach(C.categorys,function(a){a.selected=!1})):(n(),angular.forEach(C.categorys,function(a){a.selected=!1})))}function n(){C.productLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_sell_list/",dataType:"json",data:{last_count:C.products.length},success:function(a){C.productLoading=!1,a.products&&a.products.forEach(function(a){if(C.products.length){var b=_.findIndex(C.products,function(b){return b.product_uxid==a.product_uxid});-1===b?C.products.push(a):C.products[b]=a}else C.products.push(a)}),C.products.length?C.productEmpty=!1:C.productEmpty=!0,C.$apply()},complete:function(){C.productLoading=!1,C.$apply()},error:function(){C.productLoading=!1,C.$apply()}})}function o(){C.productLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_sell_list/",dataType:"json",data:{last_count:C.products.length,category_name:C.categoryNameSelected},success:function(a){C.productLoading=!1,a.products&&a.products.forEach(function(a){if(C.products.length){var b=_.findIndex(C.products,function(b){return b.product_uxid==a.product_uxid});-1===b?C.products.push(a):C.products[b]=a}else C.products.push(a)}),C.products.length?C.productEmpty=!1:C.productEmpty=!0,C.$apply()},complete:function(){C.productLoading=!1,C.$apply()},error:function(){C.productLoading=!1,C.$apply()}})}function p(){C.productLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_sell_search/",dataType:"json",data:{last_count:C.products.length,search:C.productSearch},success:function(a){C.productLoading=!1,a.products&&a.products.forEach(function(a){if(C.products.length){var b=_.findIndex(C.products,function(b){return b.product_uxid==a.product_uxid});-1===b?C.products.push(a):C.products[b]=a}else C.products.push(a)}),C.products.length?C.productEmpty=!1:C.productEmpty=!0,C.$apply()},complete:function(){C.productLoading=!1,C.$apply()},error:function(){C.productLoading=!1,C.$apply()}})}function q(){C.productLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_sell_search/",dataType:"json",data:{last_count:C.products.length,category_name:C.categoryNameSelected,search:C.productSearch},success:function(a){C.productLoading=!1,a.products&&a.products.forEach(function(a){if(C.products.length){var b=_.findIndex(C.products,function(b){return b.product_uxid==a.product_uxid});-1===b?C.products.push(a):C.products[b]=a}else C.products.push(a)}),C.products.length?C.productEmpty=!1:C.productEmpty=!0,C.$apply()},complete:function(){C.productLoading=!1,C.$apply()},error:function(){C.productLoading=!1,C.$apply()}})}function r(a){angular.forEach(C.products,function(a){a.selected=!1}),C.product=a,C.product.selected=!0}function s(){C.discountEmpty=!1,C.discountSearchText.length?(C.discounts=[],v()):(C.discounts=[],u())}function t(){C.discountEmpty=!1,C.discountSearchText.length?v():u()}function u(){C.discountLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_discount_list/",dataType:"json",data:{last_count:C.discounts.length},success:function(a){C.discountLoading=!1,a.discounts&&a.discounts.forEach(function(a){if(C.discounts.length){var b=_.findIndex(C.discounts,function(b){return b.discount_uxid==a.discount_uxid});-1===b?C.discounts.push(a):C.discounts[b]=a}else C.discounts.push(a)}),C.discounts.length?C.discountEmpty=!1:C.discountEmpty=!0,C.$apply()},complete:function(){C.discountLoading=!1,C.$apply()},error:function(){C.discountLoading=!1,C.$apply()}})}function v(){C.discountLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_discount_search/",dataType:"json",data:{last_count:C.discounts.length,search:C.discountSearchText},success:function(a){C.discountLoading=!1,a.discounts&&a.discounts.forEach(function(a){if(C.discounts.length){var b=_.findIndex(C.discounts,function(b){return b.discount_uxid==a.discount_uxid});-1===b?C.discounts.push(a):C.discounts[b]=a}else C.discounts.push(a)}),C.discounts.length?C.discountEmpty=!1:C.discountEmpty=!0,C.$apply()},complete:function(){C.discountLoading=!1,C.$apply()},error:function(){C.discountLoading=!1,C.$apply()}})}function w(){C.discountNewLoading||(C.discountNewLoading=!0,C.discountNewObj.discount_token=C.discount_token,$.ajax({context:b,type:"POST",url:A+"product_discount_save/",dataType:"json",data:C.discountNewObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),C.$apply()),a.status&&"OK"==a.status&&(C.discount_token=f("DISC"),s(),C.discountNewForm=!1,C.$apply())},complete:function(){C.discountNewLoading=!1,C.$apply()},error:function(){C.discountNewLoading=!1,C.$apply()}}))}function x(){C.discountEditLoading||(C.discountEditLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_discount_update/",dataType:"json",data:C.discountEditObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),C.$apply()),a.status&&"OK"==a.status&&(s(),C.discountEditForm=!1,C.$apply())},complete:function(){C.discountEditLoading=!1,C.$apply()},error:function(){C.discountEditLoading=!1,C.$apply()}}))}function y(a){C.discountDeleteConfirm=!0,C.discountDeleteObj=a}function z(){C.discountDeleteLoading=!0,$.ajax({context:b,type:"POST",url:A+"product_discount_delete/",dataType:"json",data:C.discountDeleteObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),C.$apply()),a.status&&"OK"==a.status&&(C.discounts=_.reject(C.discounts,function(a){return a.discount_uxid==C.discountDeleteObj.discount_uxid}),C.discountDeleteConfirm=!1,C.discounts.length?C.discountEmpty=!1:C.discountEmpty=!0,C.$apply())},complete:function(){C.discountDeleteLoading=!1,C.$apply()},error:function(){C.discountDeleteLoading=!1,C.$apply()}})}var A=a.api.url_product,B=a.api.url_product_image_host,C=b;C.windowHeight=function(){var a=$(window).height(),b=a/4,c=a-b;return c-80},C.api_url_product_image_host=B,C.productEmpty=!1;var A=a.api.url_product,B=a.api.url_product_image_host;C.api_url_product_image_host=B,C.productSelectForm=!1,C.productSelectFormOpen=function(){C.productSelectForm=!0,l()},C.categoryLoading=!1,C.categorys=[],i(),C.categoryListMore=function(){i()},C.categoryNameSelected="",C.categorySelect=j,C.categoryClearSelect=k,b.$watch("categoryNameSelected",function(a,b){(void 0!==a||null!==a)&&a!==b&&l()},!0),C.productListLoad=l,C.productListMoreCall=function(){m()},C.productLoading=!1,C.products=[],C.productList=n,C.productSearch="",C.productSelect=r,C.discountListLoad=s,C.discountListMoreCall=function(){t()},C.discountLoading=!1,C.discounts=[],C.discountList=u,C.discountSearchText="",C.discount_token=f("DISC"),angular.isDefined(c.discount_token)?C.discount_token=c.discount_token:c.discount_token=C.discount_token,C.$watch("discount_token",function(){c.discount_token=C.discount_token},!0),C.discountNewObj={discount_product_uxid:"",discount_product_name:"",discount_product_code:"",discount_product_unit:"",discount_product_base_price:"",discount_product_sale_price:"",discount_amount:"",discount_value:"",discount_token:"",discount_product_price:""},C.discountNewForm=!1,C.discountNew=function(a){C.discountNewObj.discount_product_uxid=a.product_uxid,C.discountNewObj.discount_product_name=a.product_name,C.discountNewObj.discount_product_code=a.product_code,C.discountNewObj.discount_product_unit=a.product_unit,C.discountNewObj.discount_product_base_price=a.product_base_price,C.discountNewObj.discount_product_sale_price=a.product_sale_price,C.discountNewObj.discount_amount="1",C.discountNewObj.discount_value="0",C.discountNewForm=!0},C.$watch("discountNewObj.discount_value",function(){var a=h(C.discountNewObj.discount_amount),b=h(C.discountNewObj.discount_value),c=h(C.discountNewObj.discount_product_sale_price),d=(parseFloat(a),parseFloat(b)),e=parseFloat(c),f=0;if(100>d)if(d>0){var g=d/100*e;f=e-g}else f=e;else f=e-d;C.discountNewObj.discount_product_price=f},!0),C.discountNewLoading=!1,C.discountNewSave=w,C.discountEditObj={discount_uxid:"",discount_product_uxid:"",discount_product_name:"",discount_product_code:"",discount_product_unit:"",discount_product_base_price:"",discount_product_sale_price:"",discount_amount:"",discount_value:"",discount_product_price:""},C.discountEditForm=!1,C.discountEdit=function(a){C.discountEditObj=a,C.discountEditObj.discount_amount=g(C.discountEditObj.discount_amount),C.discountEditObj.discount_value=g(C.discountEditObj.discount_value),C.discountEditForm=!0},C.$watch("discountEditObj.discount_value",function(){var a=h(C.discountEditObj.discount_amount),b=h(C.discountEditObj.discount_value),c=h(C.discountEditObj.discount_product_sale_price),d=(parseFloat(a),parseFloat(b)),e=parseFloat(c),f=0;if(100>d)if(d>0){var g=d/100*e;f=e-g}else f=e;else f=e-d;C.discountEditObj.discount_product_price=f},!0),C.discountEditLoading=!1,C.discountEditSave=x,C.discountDeleteObj={discount_uxid:"",discount_product_uxid:"",discount_product_name:"",discount_product_code:"",discount_product_unit:"",discount_product_base_price:"",discount_product_sale_price:"",discount_amount:"",discount_value:""},C.discountDeleteConfirm=!1,C.discountDelete=y,C.discountDeleteLoading=!1,C.discountDeleteYes=z,s()}angular.module("app").controller("DiscountCtrl",a),a.$inject=["$rootScope","$scope","$localStorage","toaster"]}();