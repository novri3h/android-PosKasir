!function(){"use strict";function a(a,b,c){function d(){r.customerLoading=!0,$.ajax({context:b,type:"GET",url:q+"customer_list/",dataType:"json",data:{last_count:r.customers.length},success:function(a){r.customerLoading=!1,a.customers&&(a.customers.forEach(function(a){if(r.customers.length){var b=_.findIndex(r.customers,function(b){return b.customer_uxid==a.customer_uxid});-1===b?r.customers.push(a):r.customers[b]=a}else r.customers.push(a)}),g()),r.customers.length?r.customerEmpty=!1:r.customerEmpty=!0,r.$apply()},complete:function(){r.customerLoading=!1,r.$apply()},error:function(){r.customerLoading=!1,r.$apply()}})}function e(){r.customerLoading=!0,$.ajax({context:b,type:"GET",url:q+"customer_search/",dataType:"json",data:{last_count:r.customers.length,search:r.customerSearch},success:function(a){r.customerLoading=!1,a.customers&&(a.customers.forEach(function(a){if(r.customers.length){var b=_.findIndex(r.customers,function(b){return b.customer_uxid==a.customer_uxid});-1===b?r.customers.push(a):r.customers[b]=a}else r.customers.push(a)}),g()),r.customers.length?r.customerEmpty=!1:r.customerEmpty=!0,r.$apply()},complete:function(){r.customerLoading=!1,r.$apply()},error:function(){r.customerLoading=!1,r.$apply()}})}function f(){var a=!1;return angular.forEach(r.customers,function(b){b.customer_code==r.selectedCode&&(r.customer=b,r.customer.selected=!0,a=!0,r.selectedCode=""),b.selected&&(a=!0)}),a}function g(){0==f()&&r.customers.length&&j(r.customers[0])}function h(){r.customerEmpty=!1,r.customerSearch.length?(r.customers=[],e()):(r.customers=[],d())}function i(){r.customerEmpty=!1,r.customerSearch.length?e():d()}function j(a){angular.forEach(r.customers,function(a){a.selected=!1}),r.customer=a,r.customer.selected=!0}function k(){r.customerFormNew=!0}function l(){r.customerCreateLoading=!0,$.ajax({context:b,type:"POST",url:q+"customer_save/",dataType:"json",data:r.customerObjNew,success:function(a){r.selectedCode=r.customerObjNew.customer_code,a.message&&(a.status?"OK"==a.status?c.pop("success","Info",a.message):c.pop("error","Error",a.message):c.pop("info","Message",a.message),r.$apply()),a.status&&"OK"==a.status&&(r.customerObjNew.customer_uxid="",r.customerObjNew.customer_realname="",r.customerObjNew.customer_code="",r.customerObjNew.customer_email="",r.customerObjNew.customer_company="",r.customerObjNew.customer_phone="",r.customerObjNew.customer_address1="",r.customerObjNew.customer_address2="",r.customerObjNew.customer_address3="",r.customerObjNew.customer_address4="",r.customerObjNew.customer_address5="",h(),r.customerFormNew=!1,r.$apply())},complete:function(){r.customerCreateLoading=!1,r.$apply()},error:function(){r.customerCreateLoading=!1,r.$apply()}})}function m(a){r.customerObjEdit.customer_uxid=a.customer_uxid,r.customerObjEdit.customer_realname=a.customer_realname,r.customerObjEdit.customer_code=a.customer_code,r.customerObjEdit.customer_email=a.customer_email,r.customerObjEdit.customer_company=a.customer_company,r.customerObjEdit.customer_phone=a.customer_phone,r.customerObjEdit.customer_address1=a.customer_address1,r.customerObjEdit.customer_address2=a.customer_address2,r.customerObjEdit.customer_address3=a.customer_address3,r.customerObjEdit.customer_address4=a.customer_address4,r.customerObjEdit.customer_address5=a.customer_address5,r.customerFormEdit=!0}function n(){r.customerEditLoading=!0,$.ajax({context:b,type:"POST",url:q+"customer_update/",dataType:"json",data:r.customerObjEdit,success:function(a){r.selectedCode=r.customerObjEdit.customer_code,a.message&&(a.status?"OK"==a.status?c.pop("success","Info",a.message):c.pop("error","Error",a.message):c.pop("info","Message",a.message),r.$apply()),a.status&&"OK"==a.status&&(r.customerObjEdit.customer_uxid="",r.customerObjEdit.customer_realname="",r.customerObjEdit.customer_code="",r.customerObjEdit.customer_email="",r.customerObjEdit.customer_company="",r.customerObjEdit.customer_phone="",r.customerObjEdit.customer_address1="",r.customerObjEdit.customer_address2="",r.customerObjEdit.customer_address3="",r.customerObjEdit.customer_address4="",r.customerObjEdit.customer_address5="",h(),r.customerFormEdit=!1,r.$apply())},complete:function(){r.customerEditLoading=!1,r.$apply()},error:function(){r.customerEditLoading=!1,r.$apply()}})}function o(a){r.customerDeleteConfirm=!0,r.customerObjDelete.customer_uxid=a.customer_uxid,r.customerObjDelete.customer_realname=a.customer_realname,r.customerObjDelete.customer_code=a.customer_code}function p(){r.customerDeleteLoading=!0,$.ajax({context:b,type:"GET",url:q+"customer_delete/",dataType:"json",data:r.customerObjDelete,success:function(a){a.status&&"OK"==a.status&&(r.customers=_.reject(r.customers,function(a){return a.customer_uxid==r.customerObjDelete.customer_uxid}),g(),r.customerDeleteConfirm=!1,r.customers.length?r.customerEmpty=!1:r.customerEmpty=!0,r.$apply())},complete:function(){r.customerDeleteLoading=!1,r.$apply()},error:function(){r.customerDeleteLoading=!1,r.$apply()}})}var q=a.api.url_customer,r=b;r.windowHeight=function(){var a=$(window).height(),b=a/4,c=a-b;return c-80},r.customerEmpty=!1,r.customerLoading=!1,r.customers=[],d(),r.customerList=d,r.selectedCode="",r.customerSearch="",r.customerListLoad=h,r.customerListMoreCall=function(){i()},r.customerSelect=j,r.customerObjNew={customer_uxid:"",customer_realname:"",customer_code:"",customer_email:"",customer_company:"",customer_phone:"",customer_address1:"",customer_address2:"",customer_address3:"",customer_address4:"",customer_address5:""},r.customerFormNew=!1,r.customerCreate=k,r.customerCreateLoading=!1,r.customerCreateSave=l,r.customerObjEdit={customer_uxid:"",customer_realname:"",customer_code:"",customer_email:"",customer_company:"",customer_phone:"",customer_address1:"",customer_address2:"",customer_address3:"",customer_address4:"",customer_address5:""},r.customerFormEdit=!1,r.customerEdit=m,r.customerEditLoading=!1,r.customerEditSave=n,r.customerObjDelete={customer_uxid:"",customer_realname:"",customer_code:"",customer_email:"",customer_company:"",customer_phone:"",customer_address1:"",customer_address2:"",customer_address3:"",customer_address4:"",customer_address5:""},r.customerDeleteConfirm=!1,r.customerDelete=o,r.customerDeleteLoading=!1,r.customerDeleteYes=p}angular.module("app").controller("CustomerCtrl",a),a.$inject=["$rootScope","$scope","toaster"]}();