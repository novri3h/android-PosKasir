!function(){"use strict";function a(a,b,c,d){function e(){return Math.floor((new Date).getTime()/1e3)}function f(a){a=a||"";var b=_.random(100,999);b+="";var c=e();c="M"+c;var d=c.slice(-5),f=_.uniqueId(a);return f+b+d}function g(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return 10>b&&(b="0"+b),10>c&&(c="0"+c),a=b+"/"+c+"/"+d}function h(a){var b=".",c=",",d="";a+="",a=a.replace(new RegExp(",","g"),"");for(var e=a.split(b),f=e[0].split("").reverse(),g=Array(),h=0;h<f.length;h++)g[g.length]=h%3===2&&h<f.length-1?c+f[h]:f[h];var i=g.reverse().join("");return a.indexOf(b)>=0&&parseInt(e[1])&&(i+=b+e[1]),d=i}function i(){H.supplierLoading=!0,$.ajax({context:b,type:"GET",url:F+"supplier_list/",dataType:"json",data:{last_count:H.suppliers.length},success:function(a){a.suppliers&&a.suppliers.forEach(function(a){if(H.suppliers.length){var b=_.findIndex(H.suppliers,function(b){return b.supplier_uxid==a.supplier_uxid});-1===b?H.suppliers.push(a):H.suppliers[b]=a}else H.suppliers.push(a)}),H.suppliers.length?H.supplierEmpty=!1:H.supplierEmpty=!0,H.$apply()},complete:function(){H.supplierLoading=!1,H.$apply()},error:function(){H.supplierLoading=!1,H.$apply()}})}function j(){H.supplierLoading=!0,$.ajax({context:b,type:"GET",url:F+"supplier_search/",dataType:"json",data:{last_count:H.suppliers.length,search:H.supplierSearch},success:function(a){a.suppliers&&a.suppliers.forEach(function(a){if(H.suppliers.length){var b=_.findIndex(H.suppliers,function(b){return b.supplier_uxid==a.supplier_uxid});-1===b?H.suppliers.push(a):H.suppliers[b]=a}else H.suppliers.push(a)}),H.suppliers.length?H.supplierEmpty=!1:H.supplierEmpty=!0,H.$apply()},complete:function(){H.supplierLoading=!1,H.$apply()},error:function(){H.supplierLoading=!1,H.$apply()}})}function k(){H.hutangSearch="",""==H.supplierUxidSelected?u():(H.supplierUxidSelected="",angular.forEach(H.suppliers,function(a){a.selected=!1}))}function l(a){angular.forEach(H.suppliers,function(a){a.selected=!1}),H.supplier=a,H.supplier.selected=!0,H.hutangSearch="",H.supplierUxidSelected=a.supplier_uxid}function m(){H.supplierEmpty=!1,H.supplierSearch.length?(H.suppliers=[],j()):(H.suppliers=[],i())}function n(){H.supplierEmpty=!1,H.supplierSearch.length?j():i()}function o(){if(H.cashboxs=[],H.supplierUxidSelected.length&&H.suppliers.length){var a=_.findIndex(H.suppliers,function(a){return a.supplier_uxid==H.supplierUxidSelected});a>=0&&(H.hutangCreateObj.hutang_date_start=g(),H.hutangCreateObj.hutang_tempo_day=30,H.hutangCreateObj.hutang_supplier_uxid=H.suppliers[a].supplier_uxid,H.hutangCreateObj.hutang_supplier_realname=H.suppliers[a].supplier_realname,H.hutangCreateObj.hutang_detail="Hutang ke "+H.suppliers[a].supplier_realname,H.hutangLoading=!0,$.ajax({context:b,type:"GET",url:G+"cashbox_list/",dataType:"json",success:function(a){a.cashboxs&&(a.cashboxs.forEach(function(a){if(H.cashboxs.length){var b=_.findIndex(H.cashboxs,function(b){return b.cashbox_uxid==a.cashbox_uxid});-1===b?H.cashboxs.push(a):H.cashboxs[b]=a}else H.cashboxs.push(a)}),H.optionCashboxSelected=H.cashboxs[0],H.hutangCreateObj.hutang_cashbox_uxid=H.optionCashboxSelected.cashbox_uxid,H.hutangCreateForm=!0),H.$apply()},complete:function(){H.hutangLoading=!1,H.$apply()},error:function(){H.hutangLoading=!1,H.$apply()}}))}}function p(){H.hutangSaveLoading||(H.hutangCreateObj.hutang_token=H.hutang_token,H.hutangCreateObj.hutang_cashbox_uxid=H.optionCashboxSelected.cashbox_uxid,H.hutangCreateObj.hutang_cashbox_name=H.optionCashboxSelected.cashbox_name,H.hutangSaveLoading=!0,$.ajax({context:b,type:"POST",url:E+"hutang_save/",dataType:"json",data:H.hutangCreateObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),H.$apply()),a.status&&"OK"==a.status&&(H.hutang_token=f("HTG"),u(),H.hutangCreateForm=!1,H.$apply())},complete:function(){H.hutangSaveLoading=!1,H.$apply()},error:function(){H.hutangSaveLoading=!1,H.$apply()}}))}function q(){H.hutangLoading=!0,$.ajax({context:b,type:"GET",url:E+"hutang_list/",dataType:"json",data:{last_count:H.hutangs.length},success:function(a){H.hutangLoading=!1,a.total_nilai?H.total_nilai=a.total_nilai:H.total_nilai=0,a.total_bayar?H.total_bayar=a.total_bayar:H.total_bayar=0,a.total_saldo?H.total_saldo=a.total_saldo:H.total_saldo=0,a.hutangs&&a.hutangs.forEach(function(a){if(H.hutangs.length){var b=_.findIndex(H.hutangs,function(b){return b.hutang_uxid==a.hutang_uxid});-1===b?H.hutangs.push(a):H.hutangs[b]=a}else H.hutangs.push(a)}),H.hutangs.length?H.hutangEmpty=!1:H.hutangEmpty=!0,H.$apply()},complete:function(){H.hutangLoading=!1,H.$apply()},error:function(){H.hutangLoading=!1,H.$apply()}})}function r(){H.hutangLoading=!0,$.ajax({context:b,type:"GET",url:E+"hutang_list/",dataType:"json",data:{last_count:H.hutangs.length,supplier_uxid:H.supplierUxidSelected},success:function(a){H.hutangLoading=!1,a.total_nilai?H.total_nilai=a.total_nilai:H.total_nilai=0,a.total_bayar?H.total_bayar=a.total_bayar:H.total_bayar=0,a.total_saldo?H.total_saldo=a.total_saldo:H.total_saldo=0,a.hutangs&&a.hutangs.forEach(function(a){if(H.hutangs.length){var b=_.findIndex(H.hutangs,function(b){return b.hutang_uxid==a.hutang_uxid});-1===b?H.hutangs.push(a):H.hutangs[b]=a}else H.hutangs.push(a)}),H.hutangs.length?H.hutangEmpty=!1:H.hutangEmpty=!0,H.$apply()},complete:function(){H.hutangLoading=!1,H.$apply()},error:function(){H.hutangLoading=!1,H.$apply()}})}function s(){H.hutangLoading=!0,$.ajax({context:b,type:"GET",url:E+"hutang_search/",dataType:"json",data:{last_count:H.hutangs.length,search:H.hutangSearch},success:function(a){H.hutangLoading=!1,a.total_nilai?H.total_nilai=a.total_nilai:H.total_nilai=0,a.total_bayar?H.total_bayar=a.total_bayar:H.total_bayar=0,a.total_saldo?H.total_saldo=a.total_saldo:H.total_saldo=0,a.hutangs&&a.hutangs.forEach(function(a){if(H.hutangs.length){var b=_.findIndex(H.hutangs,function(b){return b.hutang_uxid==a.hutang_uxid});-1===b?H.hutangs.push(a):H.hutangs[b]=a}else H.hutangs.push(a)}),H.hutangs.length?H.hutangEmpty=!1:H.hutangEmpty=!0,H.$apply()},complete:function(){H.hutangLoading=!1,H.$apply()},error:function(){H.hutangLoading=!1,H.$apply()}})}function t(){H.hutangLoading=!0,$.ajax({context:b,type:"GET",url:E+"hutang_search/",dataType:"json",data:{last_count:H.hutangs.length,supplier_uxid:H.supplierUxidSelected,search:H.hutangSearch},success:function(a){H.hutangLoading=!1,a.total_nilai?H.total_nilai=a.total_nilai:H.total_nilai=0,a.total_bayar?H.total_bayar=a.total_bayar:H.total_bayar=0,a.total_saldo?H.total_saldo=a.total_saldo:H.total_saldo=0,a.hutangs&&a.hutangs.forEach(function(a){if(H.hutangs.length){var b=_.findIndex(H.hutangs,function(b){return b.hutang_uxid==a.hutang_uxid});-1===b?H.hutangs.push(a):H.hutangs[b]=a}else H.hutangs.push(a)}),H.hutangs.length?H.hutangEmpty=!1:H.hutangEmpty=!0,H.$apply()},complete:function(){H.hutangLoading=!1,H.$apply()},error:function(){H.hutangLoading=!1,H.$apply()}})}function u(){H.hutangEmpty=!1,(void 0!==H.supplierUxidSelected||null!==H.supplierUxidSelected)&&(H.supplierUxidSelected.length?H.hutangSearch.length?(H.hutangs=[],t()):(H.hutangs=[],r()):H.hutangSearch.length?(H.hutangs=[],s()):(H.hutangs=[],q()))}function v(){H.hutangEmpty=!1,(void 0!==H.supplierUxidSelected||null!==H.supplierUxidSelected)&&(H.supplierUxidSelected.length?H.hutangSearch.length?t():r():H.hutangSearch.length?s():q())}function w(a){angular.forEach(H.hutangs,function(a){a.selected=!1}),H.hutang=a,H.hutang.selected=!0}function x(a){H.hutangDeleteConfirm=!0,H.hutangDeleteObj.hutang_uxid=a.hutang_uxid,H.hutangDeleteObj.hutang_detail=a.hutang_detail,H.hutangDeleteObj.hutang_reference_uxid=a.hutang_reference_uxid}function y(){H.hutangDeleteLoading=!0,$.ajax({context:b,type:"GET",url:E+"hutang_delete/",dataType:"json",data:H.hutangDeleteObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),H.$apply()),a.status&&"OK"==a.status&&(H.hutangs=_.reject(H.hutangs,function(a){return a.hutang_uxid==H.hutangDeleteObj.hutang_uxid}),H.hutangDeleteConfirm=!1,H.hutangs.length?H.hutangEmpty=!1:H.hutangEmpty=!0,H.$apply())},complete:function(){H.hutangDeleteLoading=!1,H.$apply()},error:function(){H.hutangDeleteLoading=!1,H.$apply()}})}function z(a){H.bayarLoading=!0,$.ajax({context:b,type:"GET",url:E+"bayar_list/",dataType:"json",data:{hutang_uxid:a},success:function(a){H.bayarLoading=!1,a.bayars&&(H.bayars=a.bayars,H.bayarListForm=!0),H.bayars.length?H.bayarEmpty=!1:H.bayarEmpty=!0,H.$apply()},complete:function(){H.bayarLoading=!1,H.$apply()},error:function(){H.bayarLoading=!1,H.$apply()}})}function A(a){H.cashboxs=[],H.bayarObjCreate.bayar_date=g(),H.bayarObjCreate.bayar_hutang_uxid=a.hutang_uxid,H.bayarObjCreate.bayar_hutang_supplier_realname=a.hutang_supplier_realname,H.bayarObjCreate.bayar_hutang_saldo=h(a.hutang_saldo),H.bayarObjCreate.bayar_nilai=h(a.hutang_saldo),H.bayarLoading=!0,$.ajax({context:b,type:"GET",url:G+"cashbox_list/",dataType:"json",success:function(a){a.cashboxs&&(a.cashboxs.forEach(function(a){if(H.cashboxs.length){var b=_.findIndex(H.cashboxs,function(b){return b.cashbox_uxid==a.cashbox_uxid});-1===b?H.cashboxs.push(a):H.cashboxs[b]=a}else H.cashboxs.push(a)}),H.optionCashboxSelected=H.cashboxs[0],H.bayarObjCreate.bayar_cashbox_uxid=H.optionCashboxSelected.cashbox_uxid,H.bayarCreateForm=!0),H.$apply()},complete:function(){H.bayarLoading=!1,H.$apply()},error:function(){H.bayarLoading=!1,H.$apply()}})}function B(){H.bayarSaveLoading||(H.bayarObjCreate.bayar_token=H.hutang_bayar_token,H.bayarObjCreate.bayar_cashbox_uxid=H.optionCashboxSelected.cashbox_uxid,H.bayarObjCreate.bayar_cashbox_name=H.optionCashboxSelected.cashbox_name,H.bayarSaveLoading=!0,$.ajax({context:b,type:"POST",url:E+"bayar_save/",dataType:"json",data:H.bayarObjCreate,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),H.$apply()),a.status&&"OK"==a.status&&(H.hutang_bayar_token=f("HTGB"),H.bayarCreateForm=!1,u(),z(H.bayarObjCreate.bayar_hutang_uxid),H.$apply())},complete:function(){H.bayarSaveLoading=!1,H.$apply()},error:function(){H.bayarSaveLoading=!1,H.$apply()}}))}function C(a){H.bayarDeleteConfirm=!0,H.bayarObjDelete.bayar_uxid=a.bayar_uxid}function D(){H.bayarDeleteLoading=!0,$.ajax({context:b,type:"GET",url:E+"bayar_delete/",dataType:"json",data:H.bayarObjDelete,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),H.$apply()),a.status&&"OK"==a.status&&(H.bayars=_.reject(H.bayars,function(a){return a.bayar_uxid==H.bayarObjDelete.bayar_uxid}),H.bayarDeleteConfirm=!1,H.bayars.length?H.bayarEmpty=!1:H.bayarEmpty=!0,u(),H.$apply())},complete:function(){H.bayarDeleteLoading=!1,H.$apply()},error:function(){H.bayarDeleteLoading=!1,H.$apply()}})}var E=a.api.url_hutang,F=a.api.url_supplier,G=a.api.url_cashflow,H=b;H.windowHeight=function(){var a=$(window).height(),b=a/4,c=a-b;return c-80},H.hutangEmpty=!1,H.supplierEmpty=!1,H.supplierLoading=!1,H.suppliers=[],H.supplierClearSelect=k,H.supplierUxidSelected="",H.supplierSelect=l,H.supplierSearch="",H.supplierListLoad=m,H.supplierListMoreCall=function(){n()},H.cashboxs=[],H.optionCashboxSelected={cashbox_uxid:"",cashbox_name:""},H.hutang_token=f("HTG"),angular.isDefined(c.hutang_token)?H.hutang_token=c.hutang_token:c.hutang_token=H.hutang_token,H.$watch("hutang_token",function(){c.hutang_token=H.hutang_token},!0),H.hutangCreateObj={hutang_date_start:"",hutang_tempo_day:30,hutang_supplier_uxid:"",hutang_supplier_realname:"",hutang_cashbox_uxid:"",hutang_cashbox_name:"",hutang_detail:"",hutang_nilai:"",hutang_token:H.hutang_token},H.hutangCreateForm=!1,H.hutangCreate=o,H.hutangSaveLoading=!1,H.hutangSave=p,H.total_nilai=0,H.total_bayar=0,H.total_saldo=0,H.hutangLoading=!1,H.hutangs=[],H.hutangList=q,H.hutangSearch="",H.hutangListLoad=u,H.hutangListMoreCall=function(){v()},H.hutangSelect=w,b.$watch("supplierUxidSelected",function(a){(void 0!==a||null!==a)&&u()},!0),H.hutangDeleteObj={hutang_uxid:"",hutang_detail:"",hutang_reference_uxid:""},H.hutangDeleteConfirm=!1,H.hutangDelete=x,H.hutangDeleteLoading=!1,H.hutangDeleteYes=y,H.bayarListForm=!1,H.bayarLoading=!1,H.bayars=[],H.bayarList=z,H.hutang_bayar_token=f("HTGB"),angular.isDefined(c.hutang_bayar_token)?H.hutang_bayar_token=c.hutang_bayar_token:c.hutang_bayar_token=H.hutang_bayar_token,H.$watch("hutang_bayar_token",function(){c.hutang_bayar_token=H.hutang_bayar_token},!0),H.bayarObjCreate={bayar_date:"",bayar_hutang_uxid:"",bayar_hutang_supplier_realname:"",bayar_hutang_saldo:"",bayar_cashbox_uxid:"",bayar_cashbox_name:"",bayar_nilai:"",bayar_token:""},H.bayarCreateForm=!1,H.bayarCreate=A,H.bayarSaveLoading=!1,H.bayarSave=B,H.bayarObjDelete={bayar_uxid:""},H.bayarDeleteConfirm=!1,H.bayarDelete=C,H.bayarDeleteLoading=!1,H.bayarDeleteYes=D,m()}angular.module("app").controller("HutangCtrl",a),a.$inject=["$rootScope","$scope","$localStorage","toaster"]}();