!function(){"use strict";function a(a,b,c,d){function e(){return Math.floor((new Date).getTime()/1e3)}function f(a){a=a||"";var b=_.random(100,999);b+="";var c=e();c="M"+c;var d=c.slice(-5),f=_.uniqueId(a);return f+b+d}function g(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return 10>b&&(b="0"+b),10>c&&(c="0"+c),a=b+"/"+c+"/"+d}function h(){M.cashboxLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashbox_list/",dataType:"json",success:function(a){M.cashboxLoading=!1,a.cashboxs&&a.cashboxs.forEach(function(a){if(M.cashboxs.length){var b=_.findIndex(M.cashboxs,function(b){return b.cashbox_uxid==a.cashbox_uxid});-1===b?M.cashboxs.push(a):M.cashboxs[b]=a}else M.cashboxs.push(a)}),M.$apply()},complete:function(){M.cashboxLoading=!1,M.$apply()},error:function(){M.cashboxLoading=!1,M.$apply()}})}function i(){M.cashboxLoading=!0,$.ajax({context:b,type:"POST",url:L+"cashbox_save/",dataType:"json",data:{cashbox_name:M.cashboxNewName},success:function(a){if(M.cashboxLoading=!1,M.cashboxNewName="",a.cashbox){var b=a.cashbox;if(M.cashboxs.length){var c=_.findIndex(M.cashboxs,function(a){return a.cashbox_uxid==b.cashbox_uxid});-1===c?M.cashboxs.push(b):M.cashboxs[c]=b}else M.cashboxs.push(b)}M.$apply()},complete:function(){M.cashboxLoading=!1,M.$apply()},error:function(){M.cashboxLoading=!1,M.$apply()}})}function j(a){M.cashboxDeleteConfirm=!0,M.cashboxObjDelete.cashbox_uxid=a.cashbox_uxid,M.cashboxObjDelete.cashbox_name=a.cashbox_name}function k(){M.cashboxDeleteLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashbox_delete/",dataType:"json",data:M.cashboxObjDelete,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),M.$apply()),a.status&&"OK"==a.status&&(M.cashboxs=_.reject(M.cashboxs,function(a){return a.cashbox_uxid==M.cashboxObjDelete.cashbox_uxid}),M.cashboxDeleteConfirm=!1,M.$apply())},complete:function(){M.cashboxDeleteLoading=!1,M.$apply()},error:function(){M.cashboxDeleteLoading=!1,M.$apply()}})}function l(b){"0"!=a.login_detail.login_rights_edit&&b&&b.selected&&(b.editing=!0)}function m(a){a.editing=!1,M.cashboxLoading=!0,$.ajax({context:b,type:"POST",url:L+"cashbox_update/",dataType:"json",data:a,success:function(a){if(M.cashboxLoading=!1,M.cashboxNewName="",a.cashbox){var b=a.cashbox;if(M.cashboxs.length){var c=_.findIndex(M.cashboxs,function(a){return a.cashbox_uxid==b.cashbox_uxid});-1===c?M.cashboxs.push(b):M.cashboxs[c]=b}else M.cashboxs.push(b)}M.$apply()},complete:function(){M.cashboxLoading=!1,M.$apply()},error:function(){M.cashboxLoading=!1,M.$apply()}})}function n(a){angular.forEach(M.cashboxs,function(a){a.selected=!1}),M.cashbox=a,M.cashbox.selected=!0,M.cashflowSearch="",M.cashboxUxidSelected=a.cashbox_uxid,M.optionCashboxSelected=a}function o(){M.cashflowSearch="",""==M.cashboxUxidSelected?r():(M.cashboxUxidSelected="",angular.forEach(M.cashboxs,function(a){a.selected=!1}))}function p(){if(M.cashboxUxidSelected.length&&M.cashboxs.length){var a=_.findIndex(M.cashboxs,function(a){return a.cashbox_uxid==M.cashboxUxidSelected});a>=0&&(M.cashboxObjClear.cashbox_uxid=M.cashboxs[a].cashbox_uxid,M.cashboxObjClear.cashbox_name=M.cashboxs[a].cashbox_name,M.cashboxClearConfirm=!0)}}function q(){M.cashboxClearLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashbox_clear/",dataType:"json",data:M.cashboxObjClear,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),M.$apply()),a.status&&"OK"==a.status&&(r(),M.cashboxClearConfirm=!1,M.$apply())},complete:function(){M.cashboxClearLoading=!1,M.$apply()},error:function(){M.cashboxClearLoading=!1,M.$apply()}})}function r(){M.cashflowEmpty=!1,(void 0!==M.cashboxUxidSelected||null!==M.cashboxUxidSelected)&&(M.cashboxUxidSelected.length?M.cashflowSearch.length?(M.cashflows=[],w()):(M.cashflows=[],u()):M.cashflowSearch.length?(M.cashflows=[],v()):(M.cashflows=[],t()))}function s(){M.cashflowEmpty=!1,(void 0!==M.cashboxUxidSelected||null!==M.cashboxUxidSelected)&&(M.cashboxUxidSelected.length?M.cashflowSearch.length?w():u():M.cashflowSearch.length?v():t())}function t(){M.cashflowLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashflow_list/",dataType:"json",data:{last_count:M.cashflows.length},success:function(a){M.cashflowLoading=!1,a.cashflow_in?M.cashflow_in=a.cashflow_in:M.cashflow_in=0,a.cashflow_out?M.cashflow_out=a.cashflow_out:M.cashflow_out=0,a.cashflow_balance?M.cashflow_balance=a.cashflow_balance:M.cashflow_balance=0,a.cashflows&&a.cashflows.forEach(function(a){if(M.cashflows.length){var b=_.findIndex(M.cashflows,function(b){return b.cashflow_uxid==a.cashflow_uxid});-1===b?M.cashflows.push(a):M.cashflows[b]=a}else M.cashflows.push(a)}),M.cashflows.length?M.cashflowEmpty=!1:M.cashflowEmpty=!0,M.$apply()},complete:function(){M.cashflowLoading=!1,M.$apply()},error:function(){M.cashflowLoading=!1,M.$apply()}})}function u(){M.cashflowLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashflow_list/",dataType:"json",data:{last_count:M.cashflows.length,cashbox_uxid:M.cashboxUxidSelected},success:function(a){M.cashflowLoading=!1,a.cashflow_in?M.cashflow_in=a.cashflow_in:M.cashflow_in=0,a.cashflow_out?M.cashflow_out=a.cashflow_out:M.cashflow_out=0,a.cashflow_balance?M.cashflow_balance=a.cashflow_balance:M.cashflow_balance=0,a.cashflows&&a.cashflows.forEach(function(a){if(M.cashflows.length){var b=_.findIndex(M.cashflows,function(b){return b.cashflow_uxid==a.cashflow_uxid});-1===b?M.cashflows.push(a):M.cashflows[b]=a}else M.cashflows.push(a)}),M.cashflows.length?M.cashflowEmpty=!1:M.cashflowEmpty=!0,M.$apply()},complete:function(){M.cashflowLoading=!1,M.$apply()},error:function(){M.cashflowLoading=!1,M.$apply()}})}function v(){M.cashflowLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashflow_search/",dataType:"json",data:{last_count:M.cashflows.length,search:M.cashflowSearch},success:function(a){M.cashflowLoading=!1,a.cashflow_in?M.cashflow_in=a.cashflow_in:M.cashflow_in=0,a.cashflow_out?M.cashflow_out=a.cashflow_out:M.cashflow_out=0,a.cashflow_balance?M.cashflow_balance=a.cashflow_balance:M.cashflow_balance=0,a.cashflows&&a.cashflows.forEach(function(a){if(M.cashflows.length){var b=_.findIndex(M.cashflows,function(b){return b.cashflow_uxid==a.cashflow_uxid});-1===b?M.cashflows.push(a):M.cashflows[b]=a}else M.cashflows.push(a)}),M.cashflows.length?M.cashflowEmpty=!1:M.cashflowEmpty=!0,M.$apply()},complete:function(){M.cashflowLoading=!1,M.$apply()},error:function(){M.cashflowLoading=!1,M.$apply()}})}function w(){M.cashflowLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashflow_search/",dataType:"json",data:{last_count:M.cashflows.length,cashbox_uxid:M.cashboxUxidSelected,search:M.cashflowSearch},success:function(a){M.cashflowLoading=!1,a.cashflow_in?M.cashflow_in=a.cashflow_in:M.cashflow_in=0,a.cashflow_out?M.cashflow_out=a.cashflow_out:M.cashflow_out=0,a.cashflow_balance?M.cashflow_balance=a.cashflow_balance:M.cashflow_balance=0,a.cashflows&&a.cashflows.forEach(function(a){if(M.cashflows.length){var b=_.findIndex(M.cashflows,function(b){return b.cashflow_uxid==a.cashflow_uxid});-1===b?M.cashflows.push(a):M.cashflows[b]=a}else M.cashflows.push(a)}),M.cashflows.length?M.cashflowEmpty=!1:M.cashflowEmpty=!0,M.$apply()},complete:function(){M.cashflowLoading=!1,M.$apply()},error:function(){M.cashflowLoading=!1,M.$apply()}})}function x(a){angular.forEach(M.cashflows,function(a){a.selected=!1}),M.cashflow=a,M.cashflow.selected=!0}function y(a){M.cashflowDeleteConfirm=!0,M.cashflowObjDelete.cashflow_uxid=a.cashflow_uxid,M.cashflowObjDelete.cashflow_detail=a.cashflow_detail,M.cashflowObjDelete.cashflow_reference_uxid=a.cashflow_reference_uxid}function z(){M.cashflowDeleteLoading=!0,$.ajax({context:b,type:"GET",url:L+"cashflow_delete/",dataType:"json",data:M.cashflowObjDelete,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),M.$apply()),a.status&&"OK"==a.status&&(M.cashflows=_.reject(M.cashflows,function(a){return a.cashflow_uxid==M.cashflowObjDelete.cashflow_uxid}),M.cashflowDeleteConfirm=!1,M.cashflows.length?M.cashflowEmpty=!1:M.cashflowEmpty=!0,M.$apply())},complete:function(){M.cashflowDeleteLoading=!1,M.$apply()},error:function(){M.cashflowDeleteLoading=!1,M.$apply()}})}function A(){M.cashflowObjAdd.cashflow_date=g(),M.cashflowObjAdd.cashflow_detail="Penambahan saldo",M.cashflowObjAdd.cashflow_value="",M.cashflowObjAdd.cashflow_cashbox_uxid=M.optionCashboxSelected.cashbox_uxid,M.cashflowAddForm=!0}function B(){M.cashflowAddForm=!1}function C(){M.cashflowObjAdd.cashflow_token=M.cashflow_add_token,M.cashflowObjAdd.cashflow_cashbox_uxid=M.optionCashboxSelected.cashbox_uxid,M.cashflowObjAdd.cashflow_cashbox_name=M.optionCashboxSelected.cashbox_name,M.cashflowAddSaveLoading=!0,$.ajax({context:b,type:"POST",url:L+"cashflow_add_save/",dataType:"json",data:M.cashflowObjAdd,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),M.$apply()),a.status&&"OK"==a.status&&(M.cashflow_add_token=f("CFL_add"),B(),r(),M.$apply())},complete:function(){M.cashflowAddSaveLoading=!1,M.$apply()},error:function(){M.cashflowAddSaveLoading=!1,M.$apply()}})}function D(){M.cashflowObjReduce.cashflow_date=g(),M.cashflowObjReduce.cashflow_detail="Pengurangan saldo ",M.cashflowObjReduce.cashflow_value="",M.cashflowObjReduce.cashflow_cashbox_uxid=M.optionCashboxSelected.cashbox_uxid,M.cashflowReduceForm=!0}function E(){M.cashflowReduceForm=!1}function F(){M.cashflowObjReduce.cashflow_token=M.cashflow_reduce_token,M.cashflowObjReduce.cashflow_cashbox_uxid=M.optionCashboxSelected.cashbox_uxid,M.cashflowObjReduce.cashflow_cashbox_name=M.optionCashboxSelected.cashbox_name,M.cashflowReduceSaveLoading=!0,$.ajax({context:b,type:"POST",url:L+"cashflow_reduce_save/",dataType:"json",data:M.cashflowObjReduce,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),M.$apply()),a.status&&"OK"==a.status&&(M.cashflow_reduce_token=f("CFL_reduce"),E(),r(),M.$apply())},complete:function(){M.cashflowReduceSaveLoading=!1,M.$apply()},error:function(){M.cashflowReduceSaveLoading=!1,M.$apply()}})}function G(a){M.cashbox1UxidSelected=a.cashbox_uxid,M.optionCashbox1Selected=a}function H(a){M.cashbox2UxidSelected=a.cashbox_uxid,M.optionCashbox2Selected=a}function I(){M.cashflowObjTransfer.cashflow_date=g(),M.cashflowObjTransfer.cashflow_detail="Pemindahan saldo ",M.cashflowObjTransfer.cashflow_value="",M.cashflowObjTransfer.cashflow_cashbox1_uxid=M.optionCashbox1Selected.cashbox_uxid,M.cashflowObjTransfer.cashflow_cashbox2_uxid=M.optionCashbox2Selected.cashbox_uxid,M.cashflowTransferForm=!0}function J(){M.cashflowTransferForm=!1}function K(){return M.optionCashbox1Selected.cashbox_uxid.length<1?void d.pop("info","Info","Silahkan pilih cashbox asal saldo"):M.optionCashbox2Selected.cashbox_uxid.length<1?void d.pop("info","Info","Silahkan pilih cashbox tujuan saldo"):M.optionCashbox1Selected.cashbox_uxid==M.optionCashbox2Selected.cashbox_uxid?void d.pop("info","Info","Cashbox asal dan tujuan pemindahan saldo tidak boleh sama"):(M.cashflowObjTransfer.cashflow_token=M.cashflow_transfer_token,M.cashflowObjTransfer.cashflow_cashbox1_uxid=M.optionCashbox1Selected.cashbox_uxid,M.cashflowObjTransfer.cashflow_cashbox1_name=M.optionCashbox1Selected.cashbox_name,M.cashflowObjTransfer.cashflow_cashbox2_uxid=M.optionCashbox2Selected.cashbox_uxid,M.cashflowObjTransfer.cashflow_cashbox2_name=M.optionCashbox2Selected.cashbox_name,M.cashflowTransferSaveLoading=!0,void $.ajax({context:b,type:"POST",url:L+"cashflow_transfer_save/",dataType:"json",data:M.cashflowObjTransfer,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),M.$apply()),a.status&&"OK"==a.status&&(M.cashflow_transfer_token=f("CFL_transfer"),J(),r(),M.$apply())},complete:function(){M.cashflowTransferSaveLoading=!1,M.$apply()},error:function(){M.cashflowTransferSaveLoading=!1,M.$apply()}}))}var L=a.api.url_cashflow,M=b;M.windowHeight=function(){var a=$(window).height(),b=a/4,c=a-b;return c-80},M.cashflowEmpty=!1,M.cashboxLoading=!1,M.cashboxs=[],M.cashboxNewName="",M.cashboxSave=i,M.cashboxObjDelete={cashbox_uxid:"",cashbox_name:""},M.cashboxDeleteConfirm=!1,M.cashboxDelete=j,M.cashboxDeleteLoading=!1,M.cashboxDeleteYes=k,M.cashboxEdit=l,M.cashboxUpdate=m,M.cashboxUxidSelected="",M.cashboxSelect=n,M.optionCashboxSelected={cashbox_uxid:"",cashbox_name:""},M.cashboxClearSelect=o,M.cashboxObjClear={cashbox_uxid:"",cashbox_name:""},M.cashboxClearConfirm=!1,M.cashboxClear=p,M.cashboxClearLoading=!1,M.cashboxClearYes=q,b.$watch("cashboxUxidSelected",function(a){(void 0!==a||null!==a)&&r()},!0),M.cashflowListLoad=r,M.cashflowListMoreCall=function(){s()},M.cashflow_in=0,M.cashflow_out=0,M.cashflow_balance=0,M.cashflowLoading=!1,M.cashflows=[],M.cashflowList=t,M.cashflowSearch="",M.cashflowSelect=x,M.cashflowObjDelete={cashflow_uxid:"",cashflow_detail:"",cashflow_reference_uxid:""},M.cashflowDeleteConfirm=!1,M.cashflowDelete=y,M.cashflowDeleteLoading=!1,M.cashflowDeleteYes=z,h(),M.cashflow_add_token=f("CFL_add"),angular.isDefined(c.cashflow_add_token)?M.cashflow_add_token=c.cashflow_add_token:c.cashflow_add_token=M.cashflow_add_token,M.$watch("cashflow_add_token",function(){c.cashflow_add_token=M.cashflow_add_token},!0),M.cashflowObjAdd={cashflow_date:"",cashflow_cashbox_uxid:"",cashflow_cashbox_name:"",cashflow_detail:"",cashflow_value:"",cashflow_token:""},M.cashflowAddForm=!1,M.cashflowAdd=A,M.cashflowAddCancel=B,M.cashflowAddSaveLoading=!1,M.cashflowAddSave=C,M.cashflow_reduce_token=f("CFL_reduce"),angular.isDefined(c.cashflow_reduce_token)?M.cashflow_reduce_token=c.cashflow_reduce_token:c.cashflow_reduce_token=M.cashflow_reduce_token,M.$watch("cashflow_reduce_token",function(){c.cashflow_reduce_token=M.cashflow_reduce_token},!0),M.cashflowObjReduce={cashflow_date:"",cashflow_cashbox_uxid:"",cashflow_cashbox_name:"",cashflow_detail:"",cashflow_value:"",cashflow_token:""},M.cashflowReduceForm=!1,M.cashflowReduce=D,M.cashflowReduceCancel=E,M.cashflowReduceSaveLoading=!1,M.cashflowReduceSave=F,M.cashbox1UxidSelected="",M.cashbox1Select=G,M.optionCashbox1Selected={cashbox_uxid:"",cashbox_name:""},M.cashbox2UxidSelected="",M.cashbox2Select=H,M.optionCashbox2Selected={cashbox_uxid:"",cashbox_name:""},M.cashflow_transfer_token=f("CFL_transfer"),angular.isDefined(c.cashflow_transfer_token)?M.cashflow_transfer_token=c.cashflow_transfer_token:c.cashflow_transfer_token=M.cashflow_transfer_token,M.$watch("cashflow_transfer_token",function(){c.cashflow_transfer_token=M.cashflow_transfer_token},!0),M.cashflowObjTransfer={cashflow_date:"",cashflow_cashbox1_uxid:"",cashflow_cashbox1_name:"",cashflow_cashbox2_uxid:"",cashflow_cashbox2_name:"",cashflow_detail:"",cashflow_value:"",cashflow_token:""},M.cashflowTransferForm=!1,M.cashflowTransfer=I,M.cashflowTransferCancel=J,M.cashflowTransferSaveLoading=!1,M.cashflowTransferSave=K}angular.module("app").controller("CashflowCtrl",a),a.$inject=["$rootScope","$scope","$localStorage","toaster"]}();