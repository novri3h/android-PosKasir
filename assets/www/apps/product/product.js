!function(){"use strict";function a(a,b,c,d,e){function f(){return Math.floor((new Date).getTime()/1e3)}function g(a){a=a||"";var b=_.random(100,999);b+="";var c=f();c="M"+c;var d=c.slice(-5),e=_.uniqueId(a);return e+b+d}function h(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return 10>b&&(b="0"+b),10>c&&(c="0"+c),a=b+"/"+c+"/"+d}function i(a){var b=".",c=",",d="";a+="",a=a.replace(new RegExp(",","g"),"");for(var e=a.split(b),f=e[0].split("").reverse(),g=Array(),h=0;h<f.length;h++)g[g.length]=h%3===2&&h<f.length-1?c+f[h]:f[h];var i=g.reverse().join("");return a.indexOf(b)>=0&&parseInt(e[1])&&(i+=b+e[1]),d=i}function j(){Q.categoryLoading=!0,$.ajax({context:b,type:"GET",url:O+"category_list/",dataType:"json",data:{last_count:Q.categorys.length},success:function(a){Q.categoryLoading=!1,a.categorys&&a.categorys.forEach(function(a){if(Q.categorys.length){var b=_.findIndex(Q.categorys,function(b){return b.category_uxid==a.category_uxid});-1===b?Q.categorys.push(a):Q.categorys[b]=a}else Q.categorys.push(a)}),Q.$apply()},complete:function(){Q.categoryLoading=!1,Q.$apply()},error:function(){Q.categoryLoading=!1,Q.$apply()}})}function k(){Q.categoryLoading=!0,$.ajax({context:b,type:"POST",url:O+"category_save/",dataType:"json",data:{category_name:Q.categoryNewName},success:function(a){if(Q.categoryLoading=!1,Q.categoryNewName="",a.category){var b=a.category;if(Q.categorys.length){var c=_.findIndex(Q.categorys,function(a){return a.category_uxid==b.category_uxid});-1===c?Q.categorys.push(b):Q.categorys[c]=b}else Q.categorys.push(b)}Q.$apply()},complete:function(){Q.categoryLoading=!1,Q.$apply()},error:function(){Q.categoryLoading=!1,Q.$apply()}})}function l(a){Q.categoryDeleteConfirm=!0,Q.categoryObjDelete.category_uxid=a.category_uxid,Q.categoryObjDelete.category_name=a.category_name}function m(){Q.categoryDeleteLoading=!0,$.ajax({context:b,type:"GET",url:O+"category_delete/",dataType:"json",data:Q.categoryObjDelete,success:function(a){Q.categoryLoading=!1,a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.categorys=_.reject(Q.categorys,function(a){return a.category_uxid==Q.categoryObjDelete.category_uxid})),Q.categoryDeleteConfirm=!1,Q.$apply()},complete:function(){Q.categoryDeleteLoading=!1,Q.$apply()},error:function(){Q.categoryDeleteLoading=!1,Q.$apply()}})}function n(b){a.login_detail&&"1"==a.login_detail.login_rights_edit&&b&&b.selected&&(b.editing=!0)}function o(a){a.editing=!1,Q.categoryLoading=!0,$.ajax({context:b,type:"POST",url:O+"category_update/",dataType:"json",data:a,success:function(a){if(Q.categoryLoading=!1,Q.categoryNewName="",a.category){var b=a.category;if(Q.categorys.length){var c=_.findIndex(Q.categorys,function(a){return a.category_uxid==b.category_uxid});-1===c?Q.categorys.push(b):Q.categorys[c]=b}else Q.categorys.push(b)}Q.$apply()},complete:function(){Q.categoryLoading=!1,Q.$apply()},error:function(){Q.categoryLoading=!1,Q.$apply()}})}function p(a){angular.forEach(Q.categorys,function(a){a.selected=!1}),Q.category=a,Q.category.selected=!0,Q.productSearch="",Q.categoryNameSelected=a.category_name}function q(){Q.productSearch="",""==Q.categoryNameSelected?r():Q.categoryNameSelected=""}function r(){Q.productEmpty=!1,(void 0!==Q.categoryNameSelected||null!==Q.categoryNameSelected)&&(Q.categoryNameSelected.length?Q.productSearch.length?(Q.products=[],w()):(Q.products=[],u()):Q.productSearch.length?(Q.products=[],v(),angular.forEach(Q.categorys,function(a){a.selected=!1})):(Q.products=[],t(),angular.forEach(Q.categorys,function(a){a.selected=!1})))}function s(){Q.productEmpty=!1,(void 0!==Q.categoryNameSelected||null!==Q.categoryNameSelected)&&(Q.categoryNameSelected.length?Q.productSearch.length?w():u():Q.productSearch.length?(v(),angular.forEach(Q.categorys,function(a){a.selected=!1})):(t(),angular.forEach(Q.categorys,function(a){a.selected=!1})))}function t(){Q.productLoading=!0,$.ajax({context:b,type:"GET",url:O+"product_list/",dataType:"json",data:{last_count:Q.products.length},success:function(a){Q.productLoading=!1,a.products&&a.products.forEach(function(a){if(Q.products.length){var b=_.findIndex(Q.products,function(b){return b.product_uxid==a.product_uxid});-1===b?Q.products.push(a):Q.products[b]=a}else Q.products.push(a)}),Q.products.length?Q.productEmpty=!1:Q.productEmpty=!0,Q.$apply()},complete:function(){Q.productLoading=!1,Q.$apply()},error:function(){Q.productLoading=!1,Q.$apply()}})}function u(){Q.productLoading=!0,$.ajax({context:b,type:"GET",url:O+"product_list/",dataType:"json",data:{last_count:Q.products.length,category_name:Q.categoryNameSelected},success:function(a){Q.productLoading=!1,a.products&&a.products.forEach(function(a){if(Q.products.length){var b=_.findIndex(Q.products,function(b){return b.product_uxid==a.product_uxid});-1===b?Q.products.push(a):Q.products[b]=a}else Q.products.push(a)}),Q.products.length?Q.productEmpty=!1:Q.productEmpty=!0,Q.$apply()},complete:function(){Q.productLoading=!1,Q.$apply()},error:function(){Q.productLoading=!1,Q.$apply()}})}function v(){Q.productLoading=!0,$.ajax({context:b,type:"GET",url:O+"product_search/",dataType:"json",data:{last_count:Q.products.length,search:Q.productSearch},success:function(a){Q.productLoading=!1,a.products&&a.products.forEach(function(a){if(Q.products.length){var b=_.findIndex(Q.products,function(b){return b.product_uxid==a.product_uxid});-1===b?Q.products.push(a):Q.products[b]=a}else Q.products.push(a)}),Q.products.length?Q.productEmpty=!1:Q.productEmpty=!0,Q.$apply()},complete:function(){Q.productLoading=!1,Q.$apply()},error:function(){Q.productLoading=!1,Q.$apply()}})}function w(){Q.productLoading=!0,$.ajax({context:b,type:"GET",url:O+"product_search/",dataType:"json",data:{last_count:Q.products.length,category_name:Q.categoryNameSelected,search:Q.productSearch},success:function(a){Q.productLoading=!1,a.products&&a.products.forEach(function(a){if(Q.products.length){var b=_.findIndex(Q.products,function(b){return b.product_uxid==a.product_uxid});-1===b?Q.products.push(a):Q.products[b]=a}else Q.products.push(a)}),Q.products.length?Q.productEmpty=!1:Q.productEmpty=!0,Q.$apply()},complete:function(){Q.productLoading=!1,Q.$apply()},error:function(){Q.productLoading=!1,Q.$apply()}})}function x(a){angular.forEach(Q.products,function(a){a.selected=!1}),Q.product=a,Q.product.selected=!0}function y(){Q.productObjOpen.product_unit="pcs",Q.optionCategorys=[];var a=!1;Q.categorys.forEach(function(b){var c={option_uxid:b.category_uxid,option_name:b.category_name};Q.optionCategorys.push(c),b.category_name==Q.categoryNameSelected&&(Q.optionCategorySelected=c,a=!0)}),0==a&&(Q.optionCategorySelected=Q.optionCategorys[0]),Q.productBarangFormNew=!0}function z(){Q.productObjOpen.product_unit="SERVIS",Q.optionCategorys=[];var a=!1;Q.categorys.forEach(function(b){var c={option_uxid:b.category_uxid,option_name:b.category_name};Q.optionCategorys.push(c),b.category_name==Q.categoryNameSelected&&(Q.optionCategorySelected=c,a=!0)}),0==a&&(Q.optionCategorySelected=Q.optionCategorys[0]),Q.productJasaFormNew=!0}function A(){Q.productObjOpen.product_type="BARANG",Q.productObjOpen.product_category_name=Q.optionCategorySelected?Q.optionCategorySelected.option_name:"",Q.productBarangCreateLoading=!0,$.ajax({context:b,type:"POST",url:O+"product_save/",dataType:"json",data:Q.productObjOpen,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.productObjOpen.product_name="",Q.productObjOpen.product_code="",Q.productObjOpen.product_weight="",Q.productObjOpen.product_base_price="",Q.productObjOpen.product_sale_price="",r(),Q.productBarangFormNew=!1,Q.$apply()),a.product&&(J(a.product),Q.$apply())},complete:function(){Q.productBarangCreateLoading=!1,Q.$apply()},error:function(){Q.productBarangCreateLoading=!1,Q.$apply()}})}function B(){Q.productObjOpen.product_type="JASA",Q.productObjOpen.product_category_name=Q.optionCategorySelected?Q.optionCategorySelected.option_name:"",Q.productObjOpen.product_weight=0,Q.productObjOpen.product_base_price=0,Q.productJasaCreateLoading=!0,$.ajax({context:b,type:"POST",url:O+"product_save/",dataType:"json",data:Q.productObjOpen,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.productObjOpen.product_name="",Q.productObjOpen.product_code="",Q.productObjOpen.product_weight="",Q.productObjOpen.product_base_price="",Q.productObjOpen.product_sale_price="",r(),Q.productJasaFormNew=!1,Q.$apply())},complete:function(){Q.productJasaCreateLoading=!1,Q.$apply()},error:function(){Q.productJasaCreateLoading=!1,Q.$apply()}})}function C(a){"BARANG"==a.product_type?D(a):E(a)}function D(a){Q.optionCategorys=[],Q.categorys.forEach(function(a){var b={option_uxid:a.category_uxid,option_name:a.category_name};Q.optionCategorys.push(b)});var b=_.findWhere(Q.optionCategorys,{option_name:a.product_category_name});_.size(b)?Q.optionCategorySelected=b:Q.optionCategorySelected=Q.optionCategorys[0],Q.productObjEdit.product_uxid=a.product_uxid,Q.productObjEdit.product_name=a.product_name,Q.productObjEdit.product_code=a.product_code,Q.productObjEdit.product_unit=a.product_unit,Q.productObjEdit.product_weight=i(a.product_weight),Q.productObjEdit.product_base_price=i(a.product_base_price),Q.productObjEdit.product_sale_price=i(a.product_sale_price),Q.productBarangFormEdit=!0}function E(a){Q.optionCategorys=[],Q.categorys.forEach(function(a){var b={option_uxid:a.category_uxid,option_name:a.category_name};Q.optionCategorys.push(b)});var b=_.findWhere(Q.optionCategorys,{option_name:a.product_category_name});_.size(b)?Q.optionCategorySelected=b:Q.optionCategorySelected=Q.optionCategorys[0],Q.productObjEdit.product_uxid=a.product_uxid,Q.productObjEdit.product_name=a.product_name,Q.productObjEdit.product_code=a.product_code,Q.productObjEdit.product_unit=a.product_unit,Q.productObjEdit.product_weight=i(a.product_weight),Q.productObjEdit.product_base_price=i(a.product_base_price),Q.productObjEdit.product_sale_price=i(a.product_sale_price),Q.productJasaFormEdit=!0}function F(){Q.productObjEdit.product_type="BARANG",Q.productObjEdit.product_category_name=Q.optionCategorySelected?Q.optionCategorySelected.option_name:"",Q.productBarangEditLoading=!0,$.ajax({context:b,type:"POST",url:O+"product_update/",dataType:"json",data:Q.productObjEdit,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.productObjEdit.product_name="",Q.productObjEdit.product_code="",Q.productObjEdit.product_weight="",Q.productObjEdit.product_base_price="",Q.productObjEdit.product_sale_price="",r(),Q.productBarangFormEdit=!1,Q.$apply())},complete:function(){Q.productBarangEditLoading=!1,Q.$apply()},error:function(){Q.productBarangEditLoading=!1,Q.$apply()}})}function G(){Q.productObjEdit.product_type="JASA",Q.productObjEdit.product_category_name=Q.optionCategorySelected?Q.optionCategorySelected.option_name:"",Q.productObjEdit.product_weight=0,Q.productObjEdit.product_base_price=0,Q.productJasaEditLoading=!0,$.ajax({context:b,type:"POST",url:O+"product_update/",dataType:"json",data:Q.productObjEdit,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.productObjEdit.product_name="",Q.productObjEdit.product_code="",Q.productObjEdit.product_weight="",Q.productObjEdit.product_base_price="",Q.productObjEdit.product_sale_price="",r(),Q.productJasaFormEdit=!1,Q.$apply())},complete:function(){Q.productJasaEditLoading=!1,Q.$apply()},error:function(){Q.productJasaEditLoading=!1,Q.$apply()}})}function H(a){Q.productDeleteConfirm=!0,Q.productObjDelete.product_uxid=a.product_uxid,Q.productObjDelete.product_name=a.product_name,Q.productObjDelete.product_code=a.product_code}function I(){Q.productDeleteLoading=!0,$.ajax({context:b,type:"GET",url:O+"product_delete/",dataType:"json",data:Q.productObjDelete,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.products=_.reject(Q.products,function(a){return a.product_uxid==Q.productObjDelete.product_uxid}),Q.productDeleteConfirm=!1,Q.products.length?Q.productEmpty=!1:Q.productEmpty=!0,Q.$apply())},complete:function(){Q.productDeleteLoading=!1,Q.$apply()},error:function(){Q.productDeleteLoading=!1,Q.$apply()}})}function J(a){Q.stockObjPlus.product_uxid=a.product_uxid,Q.stockObjPlus.product_name=a.product_name,Q.stockObjPlus.product_code=a.product_code,Q.stockObjPlus.product_unit=a.product_unit,Q.stockObjPlus.stock_date=h(),Q.stockObjPlus.stock_value="",Q.stockFormPlus=!0}function K(){Q.stockPlusLoading||(Q.stockObjPlus.stock_token=Q.stock_plus_token,Q.stockPlusLoading=!0,$.ajax({context:b,type:"POST",url:O+"product_stock_plus_save/",dataType:"json",data:Q.stockObjPlus,success:function(a){if(a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.product){var b=a.product;if(Q.products.length){var c=_.findIndex(Q.products,function(a){return a.product_uxid==b.product_uxid});c>=0&&(Q.products[c]=b)}L(b)}a.status&&"OK"==a.status&&(Q.stock_plus_token=g("STK_plus"),Q.stockFormPlus=!1,Q.$apply()),Q.$apply()},complete:function(){Q.stockPlusLoading=!1,Q.$apply()},error:function(){Q.stockPlusLoading=!1,Q.$apply()}}))}function L(a){Q.priceNewObj.price_product_uxid=a.product_uxid,Q.priceNewObj.price_product_name=a.product_name,Q.priceNewObj.price_product_code=a.product_code,Q.priceNewObj.price_product_unit=a.product_unit,Q.priceNewObj.price_product_base_price=a.product_base_price,Q.priceNewObj.price_product_sale_price=a.product_sale_price,Q.priceNewObj.price_name="Grosir",Q.priceNewObj.price_value=i(a.product_sale_price),Q.priceNewForm=!0,Q.priceSearchText=a.product_code,Q.productSelectForm=!1}function M(){Q.priceNewLoading||(Q.priceNewLoading=!0,Q.priceNewObj.price_token=Q.price_token,$.ajax({context:b,type:"POST",url:O+"product_price_save/",dataType:"json",data:Q.priceNewObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),Q.$apply()),a.status&&"OK"==a.status&&(Q.price_token=g("PRC"),Q.priceNewForm=!1,Q.$apply())},complete:function(){Q.priceNewLoading=!1,Q.$apply()},error:function(){Q.priceNewLoading=!1,Q.$apply()}}))}function N(){$.ajax({context:b,type:"GET",url:O+"product_export/",dataType:"json",success:function(a){a.status&&"OK"==a.status&&(Q.productExportForm=!0,Q.$apply())},complete:function(){},error:function(){}})}var O=a.api.url_product,P=a.api.url_excel,Q=b;Q.windowHeight=function(){var a=$(window).height(),b=a/4,c=a-b;return c-80},Q.productEmpty=!1,Q.categoryLoading=!1,Q.categorys=[],Q.categoryListMoreCall=function(){j()},Q.categoryNewName="",Q.categorySave=k,Q.categoryObjDelete={category_uxid:"",category_name:""},Q.categoryDeleteConfirm=!1,Q.categoryDelete=l,Q.categoryDeleteLoading=!1,Q.categoryDeleteYes=m,Q.categoryEdit=n,Q.categoryUpdate=o,Q.categoryNameSelected="",Q.categorySelect=p,Q.categoryClearSelect=q,b.$watch("categoryNameSelected",function(a){(void 0!==a||null!==a)&&r()},!0),Q.productListLoad=r,Q.productListMoreCall=function(){s()},Q.productLoading=!1,Q.products=[],Q.productList=t,Q.productSearch="",Q.productSelect=x,Q.productObjOpen={product_type:"BARANG",product_category_name:"",product_uxid:"",product_name:"",product_code:"",product_unit:"pcs",product_weight:"",product_base_price:"",product_sale_price:""},Q.optionCategorys=[],Q.productBarangFormNew=!1,Q.productBarangCreate=y,Q.productJasaFormNew=!1,Q.productJasaCreate=z,Q.productBarangCreateLoading=!1,Q.productBarangCreateSave=A,Q.productJasaCreateLoading=!1,Q.productJasaCreateSave=B,Q.productObjEdit={product_type:"BARANG",product_category_name:"",product_uxid:"",product_name:"",product_code:"",product_unit:"pcs",product_weight:"",product_base_price:"",product_sale_price:""},Q.productEdit=C,Q.productBarangFormEdit=!1,Q.productBarangEdit=D,Q.productJasaFormEdit=!1,Q.productJasaEdit=E,Q.productBarangEditLoading=!1,Q.productBarangEditSave=F,Q.productJasaEditLoading=!1,Q.productJasaEditSave=G,Q.productObjDelete={product_uxid:"",product_name:"",product_code:""},Q.productDeleteConfirm=!1,Q.productDelete=H,Q.productDeleteLoading=!1,Q.productDeleteYes=I,j(),Q.stock_plus_token=g("STK_plus"),angular.isDefined(c.stock_plus_token)?Q.stock_plus_token=c.stock_plus_token:c.stock_plus_token=Q.stock_plus_token,Q.$watch("stock_plus_token",function(){c.stock_plus_token=Q.stock_plus_token},!0),Q.stockObjPlus={product_uxid:"",product_name:"",product_code:"",product_unit:"PCS",stock_date:"",stock_value:"",stock_token:""},Q.stockFormPlus=!1,Q.stockPlusLoading=!1,Q.stockPlusSave=K,Q.price_token=g("PRC"),angular.isDefined(c.price_token)?Q.price_token=c.price_token:c.price_token=Q.price_token,Q.$watch("price_token",function(){c.price_token=Q.price_token},!0),Q.priceNewObj={price_product_uxid:"",price_product_name:"",price_product_code:"",price_product_unit:"",price_product_base_price:"",price_product_sale_price:"",price_name:"Grosir",price_value:"",price_token:""},Q.priceNewForm=!1,Q.priceNewLoading=!1,Q.priceNewSave=M,Q.productExportForm=!1,Q.productExport=N,Q.productExportLink=P+"product.xls",Q.productImportForm=!1,Q.productImportLoading=!1,Q.uploadFile=function(a){Q.productImportLoading=!0;var c=new FormData;c.append("upload_excel",a[0]),e.post(P,c,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){Q.productImportLoading=!1,"ERROR"==a?d.pop("error","Error","Ada kesalahan dalam import, file yang anda upload tidak menggunakan format XLS"):r(),b.$$phase||Q.$apply()}).error(function(){d.pop("error","Error","Gagal melakukan import produk, silahkan baca manual book aplikasi"),Q.productImportLoading=!1,b.$$phase||Q.$apply()})}}angular.module("app").controller("ProductCtrl",a),a.$inject=["$rootScope","$scope","$localStorage","toaster","$http"]}();