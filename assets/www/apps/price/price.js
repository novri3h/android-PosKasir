!function(){"use strict";function a(a,b,c,d){function e(){return Math.floor((new Date).getTime()/1e3)}function f(a){a=a||"";var b=_.random(100,999);b+="";var c=e();c="M"+c;var d=c.slice(-5),f=_.uniqueId(a);return f+b+d}function g(a){var b=".",c=",",d="";a+="",a=a.replace(new RegExp(",","g"),"");for(var e=a.split(b),f=e[0].split("").reverse(),g=Array(),h=0;h<f.length;h++)g[g.length]=h%3===2&&h<f.length-1?c+f[h]:f[h];var i=g.reverse().join("");return a.indexOf(b)>=0&&parseInt(e[1])&&(i+=b+e[1]),d=i}function h(){A.categoryLoading=!0,$.ajax({context:b,type:"POST",url:z+"category_list/",dataType:"json",data:{last_count:A.categorys.length},success:function(a){A.categoryLoading=!1,a.categorys&&a.categorys.forEach(function(a){if(A.categorys.length){var b=_.findIndex(A.categorys,function(b){return b.category_uxid==a.category_uxid});-1===b?A.categorys.push(a):A.categorys[b]=a}else A.categorys.push(a)}),A.$apply()},complete:function(){A.categoryLoading=!1,A.$apply()},error:function(){A.categoryLoading=!1,A.$apply()}})}function i(a){angular.forEach(A.categorys,function(a){a.selected=!1}),A.category=a,A.category.selected=!0,A.productSearch="",A.categoryNameSelected=a.category_name}function j(){A.productSearch="",""==A.categoryNameSelected?k():A.categoryNameSelected=""}function k(){A.productEmpty=!1,(void 0!==A.categoryNameSelected||null!==A.categoryNameSelected)&&(A.categoryNameSelected.length?A.productSearch.length?(A.products=[],p()):(A.products=[],n()):A.productSearch.length?(A.products=[],o(),angular.forEach(A.categorys,function(a){a.selected=!1})):(A.products=[],m(),angular.forEach(A.categorys,function(a){a.selected=!1})))}function l(){A.productEmpty=!1,(void 0!==A.categoryNameSelected||null!==A.categoryNameSelected)&&(A.categoryNameSelected.length?A.productSearch.length?p():n():A.productSearch.length?(o(),angular.forEach(A.categorys,function(a){a.selected=!1})):(m(),angular.forEach(A.categorys,function(a){a.selected=!1})))}function m(){A.productLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_sell_list/",dataType:"json",data:{last_count:A.products.length},success:function(a){A.productLoading=!1,a.products&&a.products.forEach(function(a){if(A.products.length){var b=_.findIndex(A.products,function(b){return b.product_uxid==a.product_uxid});-1===b?A.products.push(a):A.products[b]=a}else A.products.push(a)}),A.products.length?A.productEmpty=!1:A.productEmpty=!0,A.$apply()},complete:function(){A.productLoading=!1,A.$apply()},error:function(){A.productLoading=!1,A.$apply()}})}function n(){A.productLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_sell_list/",dataType:"json",data:{last_count:A.products.length,category_name:A.categoryNameSelected},success:function(a){A.productLoading=!1,a.products&&a.products.forEach(function(a){if(A.products.length){var b=_.findIndex(A.products,function(b){return b.product_uxid==a.product_uxid});-1===b?A.products.push(a):A.products[b]=a}else A.products.push(a)}),A.products.length?A.productEmpty=!1:A.productEmpty=!0,A.$apply()},complete:function(){A.productLoading=!1,A.$apply()},error:function(){A.productLoading=!1,A.$apply()}})}function o(){A.productLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_sell_search/",dataType:"json",data:{last_count:A.products.length,search:A.productSearch},success:function(a){A.productLoading=!1,a.products&&a.products.forEach(function(a){if(A.products.length){var b=_.findIndex(A.products,function(b){return b.product_uxid==a.product_uxid});-1===b?A.products.push(a):A.products[b]=a}else A.products.push(a)}),A.products.length?A.productEmpty=!1:A.productEmpty=!0,A.$apply()},complete:function(){A.productLoading=!1,A.$apply()},error:function(){A.productLoading=!1,A.$apply()}})}function p(){A.productLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_sell_search/",dataType:"json",data:{last_count:A.products.length,category_name:A.categoryNameSelected,search:A.productSearch},success:function(a){A.productLoading=!1,a.products&&a.products.forEach(function(a){if(A.products.length){var b=_.findIndex(A.products,function(b){return b.product_uxid==a.product_uxid});-1===b?A.products.push(a):A.products[b]=a}else A.products.push(a)}),A.products.length?A.productEmpty=!1:A.productEmpty=!0,A.$apply()},complete:function(){A.productLoading=!1,A.$apply()},error:function(){A.productLoading=!1,A.$apply()}})}function q(a){angular.forEach(A.products,function(a){a.selected=!1}),A.product=a,A.product.selected=!0}function r(){A.priceEmpty=!1,A.priceSearchText.length?(A.prices=[],u()):(A.prices=[],t())}function s(){A.priceEmpty=!1,A.priceSearchText.length?u():t()}function t(){A.priceLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_price_list/",dataType:"json",data:{last_count:A.prices.length},success:function(a){A.priceLoading=!1,a.prices&&a.prices.forEach(function(a){if(A.prices.length){var b=_.findIndex(A.prices,function(b){return b.price_uxid==a.price_uxid});-1===b?A.prices.push(a):A.prices[b]=a}else A.prices.push(a)}),A.prices.length?A.priceEmpty=!1:A.priceEmpty=!0,A.$apply()},complete:function(){A.priceLoading=!1,A.$apply()},error:function(){A.priceLoading=!1,A.$apply()}})}function u(){A.priceLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_price_search/",dataType:"json",data:{last_count:A.prices.length,search:A.priceSearchText},success:function(a){A.priceLoading=!1,a.prices&&a.prices.forEach(function(a){if(A.prices.length){var b=_.findIndex(A.prices,function(b){return b.price_uxid==a.price_uxid});-1===b?A.prices.push(a):A.prices[b]=a}else A.prices.push(a)}),A.prices.length?A.priceEmpty=!1:A.priceEmpty=!0,A.$apply()},complete:function(){A.priceLoading=!1,A.$apply()},error:function(){A.priceLoading=!1,A.$apply()}})}function v(){A.priceNewLoading||(A.priceNewLoading=!0,A.priceNewObj.price_token=A.price_token,$.ajax({context:b,type:"POST",url:z+"product_price_save/",dataType:"json",data:A.priceNewObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),A.$apply()),a.status&&"OK"==a.status&&(A.price_token=f("PRC"),r(),A.priceNewForm=!1,A.$apply())},complete:function(){A.priceNewLoading=!1,A.$apply()},error:function(){A.priceNewLoading=!1,A.$apply()}}))}function w(){A.priceEditLoading||(A.priceEditLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_price_update/",dataType:"json",data:A.priceEditObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),A.$apply()),a.status&&"OK"==a.status&&(r(),A.priceEditForm=!1,A.$apply())},complete:function(){A.priceEditLoading=!1,A.$apply()},error:function(){A.priceEditLoading=!1,A.$apply()}}))}function x(a){A.priceDeleteConfirm=!0,A.priceDeleteObj=a}function y(){A.priceDeleteLoading=!0,$.ajax({context:b,type:"POST",url:z+"product_price_delete/",dataType:"json",data:A.priceDeleteObj,success:function(a){a.message&&(a.status?"OK"==a.status?d.pop("success","Info",a.message):d.pop("error","Error",a.message):d.pop("info","Message",a.message),A.$apply()),a.status&&"OK"==a.status&&(A.prices=_.reject(A.prices,function(a){return a.price_uxid==A.priceDeleteObj.price_uxid}),A.priceDeleteConfirm=!1,A.prices.length?A.priceEmpty=!1:A.priceEmpty=!0,A.$apply())},complete:function(){A.priceDeleteLoading=!1,A.$apply()},error:function(){A.priceDeleteLoading=!1,A.$apply()}})}var z=a.api.url_product,A=b;A.windowHeight=function(){var a=$(window).height(),b=a/4,c=a-b;return c-80},A.productEmpty=!1;var z=a.api.url_product;A.productSelectForm=!1,A.productSelectFormOpen=function(){A.productSearch=A.priceSearchText,A.productSelectForm=!0,k()},A.categoryLoading=!1,A.categorys=[],h(),A.categoryListMore=function(){h()},A.categoryNameSelected="",A.categorySelect=i,A.categoryClearSelect=j,b.$watch("categoryNameSelected",function(a,b){(void 0!==a||null!==a)&&a!==b&&k()},!0),A.productListLoad=k,A.productListMoreCall=function(){l()},A.productLoading=!1,A.products=[],A.productList=m,A.productSearch="",A.productSelect=q,A.priceListLoad=r,A.priceListMoreCall=function(){s()},A.priceLoading=!1,A.prices=[],A.priceList=t,A.priceSearchText="",A.price_token=f("PRC"),angular.isDefined(c.price_token)?A.price_token=c.price_token:c.price_token=A.price_token,A.$watch("price_token",function(){c.price_token=A.price_token},!0),A.priceNewObj={price_product_uxid:"",price_product_name:"",price_product_code:"",price_product_unit:"",price_product_base_price:"",price_product_sale_price:"",price_name:"Grosir",price_value:"",price_token:""},A.priceNewForm=!1,A.priceNew=function(a){A.priceNewObj.price_product_uxid=a.product_uxid,A.priceNewObj.price_product_name=a.product_name,A.priceNewObj.price_product_code=a.product_code,A.priceNewObj.price_product_unit=a.product_unit,A.priceNewObj.price_product_base_price=a.product_base_price,A.priceNewObj.price_product_sale_price=a.product_sale_price,A.priceNewObj.price_name="Grosir",A.priceNewObj.price_value=g(a.product_sale_price),A.priceNewForm=!0,A.priceSearchText=a.product_code,A.productSelectForm=!1},A.priceNewLoading=!1,A.priceNewSave=v,A.priceEditObj={price_uxid:"",price_product_uxid:"",price_product_name:"",price_product_code:"",price_product_unit:"",price_product_base_price:"",price_product_sale_price:"",price_name:"Grosir",price_value:""},A.priceEditForm=!1,A.priceEdit=function(a){A.priceEditObj.price_uxid=a.price_uxid,A.priceEditObj.price_product_uxid=a.price_product_uxid,A.priceEditObj.price_product_name=a.price_product_name,A.priceEditObj.price_product_code=a.price_product_code,A.priceEditObj.price_product_unit=a.price_product_unit,A.priceEditObj.price_product_base_price=a.price_product_base_price,A.priceEditObj.price_product_sale_price=a.price_product_sale_price,A.priceEditObj.price_name=a.price_name,A.priceEditObj.price_value=g(a.price_value),A.priceEditForm=!0,A.priceSearchText=a.price_product_code},A.priceEditLoading=!1,A.priceEditSave=w,A.priceDeleteObj={price_uxid:"",price_product_uxid:"",price_product_name:"",price_product_code:"",price_product_unit:"",price_product_base_price:"",price_product_sale_price:"",price_name:"Grosir",price_value:""},A.priceDeleteConfirm=!1,A.priceDelete=x,A.priceDeleteLoading=!1,A.priceDeleteYes=y,r()}angular.module("app").controller("PriceCtrl",a),a.$inject=["$rootScope","$scope","$localStorage","toaster"]}();